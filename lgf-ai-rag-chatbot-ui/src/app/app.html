<div class="main-container">
  <div class="left-panel">
    <div class="file-list-section">
      <div class="file-header">
        <h2>Documents</h2>
        <div class="file-actions">
          <button mat-raised-button color="primary" (click)="openUploadModal(uploadModal)">Upload</button>
          <button mat-raised-button color="accent" (click)="consultFiles()">Search</button>
        </div>
      </div>
      <div class="file-list">
        <table mat-table [dataSource]="files" class="mat-elevation-z2 file-table">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let file">{{file.name}}</td>
          </ng-container>
          <!-- Type Column -->
          <ng-container matColumnDef="contentType">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let file">{{file.contentType}}</td>
          </ng-container>
          <!-- Size Column -->
          <ng-container matColumnDef="size">
            <th mat-header-cell *matHeaderCellDef>Size</th>
            <td mat-cell *matCellDef="let file">{{file.size}} bytes</td>
          </ng-container>
          <!-- Ingested Date Column -->
          <ng-container matColumnDef="ingestedAt">
            <th mat-header-cell *matHeaderCellDef>Ingested date</th>
            <td mat-cell *matCellDef="let file">{{file.ingestedAt | date:'short'}} </td>
          </ng-container>
          <!-- Actions Column -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let file">
              <button mat-flat-button color="warn" (click)="$event.stopPropagation(); deleteFile(file)" aria-label="Delete document" class="delete-btn-rect">
                Delete
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['name', 'contentType', 'size', 'ingestedAt', 'acciones']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['name', 'contentType', 'size', 'ingestedAt', 'acciones'];" (click)="selectFile(row)" [class.selected]="selectedFile?.id === row.id"></tr>
        </table>
        <mat-paginator [length]="totalElements" [pageSize]="size" [pageIndex]="page" [pageSizeOptions]="[5, 10, 20]" (page)="onPageChange($event)"></mat-paginator>
      </div>
    </div>
    <div class="document-content-view">
      <h3>Document Content</h3>
      <div class="document-content-scroll">
        <pre *ngIf="selectedFile">{{selectedFile.content}}</pre>
        <div *ngIf="!selectedFile" class="document-placeholder">Select a document to view its content.</div>
      </div>
    </div>
  </div>
  <div class="right-panel">
    <div class="chatbot-window">
      <app-chatbot></app-chatbot>
    </div>
  </div>
</div>
<ng-template #uploadModal>
  <div mat-dialog-content class="upload-modal">
    <h2 mat-dialog-title>Upload file</h2>
    <div style="width:100%;margin-bottom:16px;">
      <label for="fileInput" style="display:block;margin-bottom:8px;font-weight:500;">Select a file</label>
      <input id="fileInput" type="file" (change)="onFileSelected($event)" style="width:100%;" />
    </div>
    <div mat-dialog-actions class="modal-actions" style="justify-content: flex-end;">
      <button mat-raised-button color="primary" (click)="confirmUpload()" [disabled]="!selectedUploadFile">Upload</button>
      <button mat-raised-button color="accent" (click)="closeUploadModal()">Cancel</button>
    </div>
  </div>
</ng-template>
<!-- Modal de confirmación para eliminar documento (traducido al inglés) -->
<div *ngIf="showDeleteModal" class="delete-modal-overlay">
  <div class="delete-modal">
    <h2>Delete confirmation</h2>
    <p>Are you sure you want to delete the document <b>{{documentToDelete?.name}}</b>?</p>
    <div class="modal-actions">
      <button mat-raised-button color="warn" (click)="confirmDelete()">Confirm</button>
      <button mat-raised-button color="accent" (click)="cancelDelete()">Cancel</button>
    </div>
  </div>
</div>
<!-- Overlay de carga global -->
<div *ngIf="loading" class="global-loading-overlay">
  <div class="global-loading-spinner">
    <div class="spinner"></div>
    <div class="loading-text">Processing...</div>
  </div>
</div>
